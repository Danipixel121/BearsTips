---
import Layout from './Layout.astro';

const { titulo, contenido, description, slug, categoria } = Astro.props;

const pageTitle = `${titulo} | BearStips`;
const canonical = `https://bearstips.com/es/tutorial/${categoria}/${slug}`;
---

<Layout
  title={pageTitle}
  description={description}
  canonical={canonical}
>
  <main>
    <article class="tutorial">
      <h1>{titulo}</h1>
      <div class="contenido-tutorial" set:html={contenido}></div>
    </article>
  </main>
</Layout>

<style is:global>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Sora:wght@400;600;700&display=swap');
@import 'prismjs/themes/prism-tomorrow.css';

:root {
  --bg-code: #1a1a1a;
  --bg-code-inner: #111111;
  --green-label: #16a34a;
  --green-label-hover: #15803d;
  --border-code: #2e2e2e;
  --text-body: #374151;
  --text-heading: #0f172a;
  --accent: #16a34a;
}

body {
  font-family: 'Sora', sans-serif;
  margin: 0;
  padding: 0;
  background: #f9fafb;
  color: var(--text-body);
}

main {
  max-width: 820px;
  margin: 40px auto;
  padding: 0 24px;
}

/* ── Code blocks — dark terminal style ── */
.contenido-tutorial pre {
  position: relative;
  background: var(--bg-code) !important;
  border: 1px solid var(--border-code);
  border-radius: 12px;
  overflow: hidden;
  margin: 1.6em 0;
  padding: 0;
  font-family: 'JetBrains Mono', Consolas, Monaco, monospace;
  font-size: 13.5px;
  line-height: 1.7;
  max-height: 480px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.18);
}

/* Top bar inside code block */
.contenido-tutorial pre::before {
  content: '';
  display: block;
  height: 2px;
  background: linear-gradient(90deg, var(--green-label), #22c55e, transparent);
  border-radius: 12px 12px 0 0;
}

.contenido-tutorial pre code {
  display: block;
  padding: 1.2rem 1.4rem 1.4rem !important;
  overflow-x: auto;
  background: transparent !important;
  color: #e0e0e0;
  scrollbar-width: thin;
  scrollbar-color: #333 transparent;
}

.contenido-tutorial pre code::-webkit-scrollbar {
  height: 6px;
}
.contenido-tutorial pre code::-webkit-scrollbar-track { background: transparent; }
.contenido-tutorial pre code::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

/* Prism token overrides to match screenshot style */
.token.tag { color: #f47067 !important; }
.token.attr-name { color: #f8d875 !important; }
.token.attr-value,
.token.string { color: #7ee787 !important; }
.token.punctuation { color: #8b8b8b !important; }
.token.comment { color: #6b7280 !important; font-style: italic; }
.token.keyword { color: #f47067 !important; }
.token.property { color: #7ee787 !important; }
.token.selector { color: #f47067 !important; }

/* Language label — top right, green pill */
.language-label {
  position: absolute;
  top: 12px;
  right: 12px;
  background: var(--green-label);
  color: #fff;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.72rem;
  font-weight: 700;
  padding: 3px 9px;
  border-radius: 5px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  z-index: 10;
  user-select: none;
}

/* Copy button */
.copy-btn {
  position: absolute;
  top: 40px;
  right: 12px;
  background: transparent;
  color: #aaa;
  border: 1px solid #3a3a3a;
  padding: 5px 8px;
  font-size: 12px;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  transition: all 0.15s ease;
  z-index: 10;
}
.copy-btn svg { width: 13px; height: 13px; stroke: currentColor; fill: none; }
.copy-btn:hover { background: #2a2a2a; border-color: #555; color: #fff; }
.copy-btn.copied { background: var(--green-label); border-color: var(--green-label); color: #fff; }

/* ── Tutorial typography ── */
h1 {
  font-size: 2.4rem;
  font-weight: 700;
  color: var(--text-heading);
  line-height: 1.2;
  margin-bottom: 0.4em;
  letter-spacing: -0.02em;
}

.contenido-tutorial h2 {
  font-size: 1.6rem;
  font-weight: 700;
  margin-top: 2.2em;
  margin-bottom: 0.5em;
  color: var(--text-heading);
  letter-spacing: -0.01em;
  border-left: 3px solid var(--accent);
  padding-left: 12px;
}

.contenido-tutorial h3 {
  font-size: 1.1rem;
  font-weight: 600;
  margin-top: 1.8em;
  color: #1f2937;
}

.contenido-tutorial p {
  line-height: 1.8;
  color: var(--text-body);
  margin: 0.7em 0 1.1em;
}

.contenido-tutorial a {
  color: #16a34a;
  text-decoration: underline;
  text-underline-offset: 3px;
}

.contenido-tutorial img {
  max-width: 100%;
  border-radius: 10px;
  margin: 1.2em 0;
  border: 1px solid #e5e7eb;
}

.contenido-tutorial ul,
.contenido-tutorial ol {
  padding-left: 1.5em;
  line-height: 1.9;
  color: var(--text-body);
}

.contenido-tutorial li { margin-bottom: 0.3em; }

/* Inline code */
.contenido-tutorial :not(pre) > code {
  background: #1a1a1a;
  color: #7ee787;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.88em;
  padding: 2px 7px;
  border-radius: 5px;
  border: 1px solid #2e2e2e;
}

article.tutorial {
  border-top: 2px solid #e5e7eb;
  padding-top: 28px;
}
</style>

<script is:inline>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll('.contenido-tutorial pre').forEach(pre => {
    // Language label
    if (!pre.querySelector('.language-label')) {
      const codeEl = pre.querySelector('code');
      const lang = (codeEl?.className || '')
        .split(' ')
        .find(c => c.startsWith('language-'))
        ?.replace('language-', '')
        .toUpperCase() || 'CODE';

      const label = document.createElement('div');
      label.className = 'language-label';
      label.textContent = lang;
      pre.appendChild(label);
    }

    // Copy button with icon
    if (!pre.querySelector('.copy-btn')) {
      const btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.setAttribute('aria-label', 'Copiar código');
      btn.innerHTML = `
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      `;

      btn.addEventListener('click', async () => {
        const codeEl = pre.querySelector('code');
        const text = codeEl ? codeEl.innerText : pre.innerText;
        try {
          await navigator.clipboard.writeText(text);
        } catch {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.cssText = 'position:fixed;opacity:0;pointer-events:none';
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
        }

        btn.innerHTML = `
          <svg viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        `;
        btn.classList.add('copied');
        setTimeout(() => {
          btn.innerHTML = `
            <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          `;
          btn.classList.remove('copied');
        }, 2000);
      });

      pre.appendChild(btn);
    }
  });

  if (typeof Prism !== 'undefined') Prism.highlightAll();
});
</script>