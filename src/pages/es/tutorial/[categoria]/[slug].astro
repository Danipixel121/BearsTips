---
import { supabase } from '../../../../lib/supabase.ts';
import TutorialLayout from '../../../../layouts/TutorialLayout.astro';

const { categoria, slug } = Astro.params;

const { data: tutorialData } = await supabase
  .from('tutoriales')
  .select(`
    *,
    traducciones:tutoriales_traducciones(*)
  `)
  .eq('slug', slug)
  .single();

if (!tutorialData) return Astro.redirect('/es');

const traduccion = tutorialData.traducciones.find(tr => tr.idioma === 'es');

const tutorial = {
  titulo: traduccion?.titulo || '',
  contenido: traduccion?.contenido || '',
  logo: tutorialData.logo_url
};
---

<TutorialLayout
  titulo={tutorial.titulo}
  contenido={tutorial.contenido}
  description={tutorial.descripcion}
  slug={slug}
  categoria={categoria}
/>